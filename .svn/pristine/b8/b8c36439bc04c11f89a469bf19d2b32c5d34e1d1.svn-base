<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%><%@ page import="java.net.URL"%><%@ page import="java.net.URLConnection"%><%@ page import="java.net.HttpURLConnection "%><%@ page import="java.net.URLEncoder"%><%@ page import="java.io.BufferedReader"%><%@ page import="java.io.InputStreamReader"%><%@ page import="com.osan.portal.vo.LoginInfo" %><%	/*	 * Office 365 Link Guide	 * 	 *	 * [1] 적용 전 협의되어야 할 내용	 *	 * 1. O365 가입센터 관리자에게 문의하여 O365 가입센터로 연결 할 URL을 받으셔야합니다.	 * 하단 o365RegUrl 변수에서 "http://xxx.o365univ.net"의 내용으로 들어갈 URL입니다.	 *	 * 2. O365 가입센터로 연결 할 링크 및 버튼이 있는 화면의 URL을 O365 가입센터 관리자에게 알려주시기 바랍니다.	 * 해당 화면의 URL을 통해서만 가입센터 연결이 가능합니다.	 * 해당 화면의 URL을 하단 acsAlowUrl 변수에 입력해 주시기 바랍니다.	 * 예시) 대표 사이트 URL >> String acsAlowUrl = "www.학교.ac.kr";	 * 	 *	 * [2] 협의 후 적용 사항	 *	 * 1. 담당자와 협의 완료 후 아래의 필수 값 및 선택 값들을 지정 해주셔야합니다.	 *	 * 필수값 : o365RegUrl = "http://가입센터URL"	 * 		  acsAlowUrl = "학교측URL"	 * 		  userId = "TEST0001"	 * 		  mberType = "S"	 * 		  regAlowYn = "Y"	 *	 */	/**********************************************************************************************************	***********************************************************************************************************	* userId, mberType, regAlowYn 값은 학교 내 회원 검증을 위해 회원세션에서 가져온 값으로 세팅해 주시길 바랍니다.	***********************************************************************************************************	***********************************************************************************************************/	/*	 * ※담당자 연락처	 * IT서비스 사업부 김광석 차장(Kwang-Seok.Kim@corebd.co.kr)	 * 개발팀 정순민 사원(Soon-Min.Jeong@corebd.co.kr)	 */	// [필수값] 학교전용 가입센터 url : O365 가입센터 관리자에게 문의하여 O365 가입센터로 연결 할 URL을 입력합니다.	String o365RegUrl = "http://osan2.o365univ.net";	// [필수값] 학교 홈페이지 domain 주소 (프로트콜[http, https]은 입력하지 않아야 합니다.)	String acsAlowUrl = "osan.ac.kr";	// [필수값] 학생의 학번, 교직원의 직원번호 혹은 login_id 값을 입력합니다.	LoginInfo loginSessionInfo = (LoginInfo)request.getSession().getAttribute("sessionUserInfo");	String userId = loginSessionInfo.getUserNo();	//학생인 경우 : "S", 교직원인경우 : "P"	String tmpUser = userId;	String mbmerType = "";	if (tmpUser.length() > 7){ 		mbmerType = "S";	}else{		mbmerType = "P";	}	// [필수값] 학생인 경우 : "S", 교직원인경우 : "P"	String mberType = mbmerType;	// [필수값] Office 365 가입 허용 여부입니다. 특정 사용자의 가입을 제한 하시려면 "N"으로 지정합니다. 	// 가입허용사용자 : "Y", 가입제한자 : "N" (소문자도 가능)	String regAlowYn = "Y";	/*	* 이하 소스 부분은 수정하지 마세요. 오류가 발생 할 수 있습니다.	*/	HttpURLConnection connection = null;	BufferedReader reader = null;	StringBuffer param = new StringBuffer();	StringBuffer result = new StringBuffer();	String line = null;	String acsKey = "";	try {		param.append("?");		param.append("acs_alow_url=");		param.append(acsAlowUrl);		param.append("&");		param.append("scl_login_id=");		param.append(userId);		param.append("&");		param.append("job_title=");		param.append(mberType);		param.append("&");		param.append("reg_alow_yn=");		param.append(regAlowYn);    	URL url = new URL(o365RegUrl + "/o365/regist/acsCrt.do" + param.toString());    	connection = (HttpURLConnection) url.openConnection();    	connection.setRequestMethod("POST");    	connection.setRequestProperty("Content-Type", "application/x-www-form-urlencoded");    	connection.setUseCaches(false);    	connection.setConnectTimeout(5000);    	connection.setReadTimeout(5000);    	reader = new BufferedReader(new InputStreamReader(connection.getInputStream(), "UTF-8"));	    while ((line = reader.readLine()) != null) {	    	result.append(line);	    }    	if(!result.toString().startsWith("<")){    		acsKey = result.toString().trim();    		    	}	} catch (Exception e) {	} finally {		if(reader != null){			try{				reader.close();			} catch(Exception e){			}		}	    if (connection != null) {	        try{	        	connection.disconnect();	        } catch(Exception e){
	        }	    }	}%><!DOCTYPE HTML><html><head></head><body>	<form name="O365RegForm" id="O365RegForm" method="post" action="<%=o365RegUrl %>/o365/regist/center.do">		<input type="hidden" name="acs_key" value="<%=acsKey %>" />	</form>	<script type="text/javascript">		var f = document.getElementById("O365RegForm");		f.submit();	</script></body></html>	